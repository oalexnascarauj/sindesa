<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Regras de Negócio - Carência de Comunicações</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(120deg, #f8fafc 0%, #e3e7ea 100%);
      margin: 0;
      padding: 0;
      color: #222;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 40px 32px 32px 32px;
    }
    h1 {
      text-align: center;
      font-size: 2.3em;
      color: #2a4d7c;
      margin-bottom: 10px;
    }
    h2 {
      color: #2a4d7c;
      margin-top: 32px;
      font-size: 1.4em;
      border-bottom: 1px solid #e3e7ea;
      padding-bottom: 4px;
    }
    h3 {
      color: #3a6ea5;
      margin-top: 24px;
      font-size: 1.15em;
    }
    ul, ol {
      margin-left: 24px;
      margin-bottom: 16px;
    }
    .fluxo {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
      margin: 32px 0;
      justify-content: space-between;
    }
    .fluxo-col {
      flex: 1 1 350px;
      background: #f4f7fa;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 24px 18px;
      min-width: 320px;
    }
    .fluxo-col h4 {
      margin-top: 0;
      color: #2a4d7c;
      font-size: 1.1em;
      margin-bottom: 10px;
    }
    .fluxo-col ol {
      margin-left: 18px;
    }
    .mermaid {
      background: #f8fafc;
      border-radius: 8px;
      padding: 16px;
      margin-top: 10px;
      margin-bottom: 10px;
      font-size: 0.98em;
      overflow-x: auto;
      border: 1px solid #e3e7ea;
    }
    .obs {
      background: #e3e7ea;
      border-left: 4px solid #2a4d7c;
      <!DOCTYPE html>
      border-radius: 8px;
      margin: 32px 0 0 0;
      color: #2a4d7c;
      font-size: 1.05em;
    }
    @media (max-width: 900px) {
      .container { padding: 18px 6px; }
      .fluxo { flex-direction: column; gap: 18px; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
  </script>
</head>
<body>
  <div class="container">
    <h1>Regras de Negócio - Carência de Comunicações</h1>
    <p>Este documento apresenta de forma visual e explicativa as regras de negócio para carência de comunicações no Sindesa, incluindo os fluxos de evolução de rebanho e nascimento, e o tratamento de comunicações em análise.</p>

    <h2>1. Evolução de Rebanho</h2>
    <div class="fluxo">
      <div class="fluxo-col">
        <h4>Antes</h4>
        <ol>
          <li>Usuário solicita evolução de animais.</li>
          <li>Sistema consulta saldo apto por espécie/faixa etária.</li>
          <li>Verifica carência apenas por espécie.</li>
          <li>Permite evolução e atualiza saldo se houver saldo apto suficiente.</li>
          <li>Campos de saldo temporário/parcial podem ser exibidos.</li>
          <li>Não há controle detalhado de datas de chegada/evolução.</li>
        </ol>
        <div class="mermaid">
flowchart TD
    INICIO([Solicitação de evolução]) --> CONSULTA_SALDO([Consulta saldo apto por espécie/faixa etária])
    CONSULTA_SALDO --> VERIFICA_CARENCIA([Verifica carência por espécie])
    VERIFICA_CARENCIA --> DECISAO{Saldo apto suficiente?}
    DECISAO -- Não --> BLOQUEIA([Bloqueia operação])
    DECISAO -- Sim --> PERMITE([Permite evolução])
    PERMITE --> ATUALIZA_SALDO([Atualiza saldo])
        </div>
      </div>
      <div class="fluxo-col">
        <h4>Depois</h4>
        <ol>
          <li>Usuário solicita evolução de animais, informando espécie, faixa etária e quantidade.</li>
          <li>Sistema consulta saldo apto por espécie, faixa etária e datas de chegada/evolução.</li>
          <li>Verifica carência específica da faixa etária.</li>
          <li>Para cada grupo, verifica datas de chegada/evolução + carência.</li>
          <li>Permite evolução e atualiza saldo apto se houver saldo suficiente.</li>
          <li>Se não, exibe questionário de justificativa obrigatório.</li>
          <li>Comunicação entra em análise e aguarda aprovação.</li>
          <li>Se aprovada, efetiva comunicação e atualiza saldos. <b>Motivo da recusa permanece em branco.</b></li>
          <li>Se reprovada, servidor deve preencher <b>Motivo da recusa</b> e descarta comunicação.</li>
          <li>Remove campos de saldo temporário/parcial da interface.</li>
        </ol>
        <div class="mermaid">
flowchart TD
    INICIO_D([Solicitação de evolução]) --> CONSULTA_SALDO_D([Consulta saldo apto por espécie/faixa etária e datas])
    CONSULTA_SALDO_D --> VERIFICA_CARENCIA_D([Verifica carência por faixa etária])
    VERIFICA_CARENCIA_D --> DECISAO_D{Carência cumprida?}
    DECISAO_D -- Sim --> PERMITE_D([Permite evolução])
    DECISAO_D -- Não --> QUESTIONARIO_D([Exibe questionário de justificativa])
    QUESTIONARIO_D --> SALVA_COMUNIC_D([Salva comunicação em análise])
    SALVA_COMUNIC_D --> ANALISE_D([Servidor analisa comunicação])
    ANALISE_D --> APROVACAO_D{Aprovar comunicação?}
    APROVACAO_D -- Sim --> EFETIVA_D([Efetiva comunicação e atualiza saldo])
    APROVACAO_D -- Não --> MOTIVO_RECUSA_D([Preencher motivo da recusa])
    MOTIVO_RECUSA_D --> DESCARTA_D([Descarta comunicação])
    DESCARTA_D --> FIM_D([Fim])
    EFETIVA_D --> FIM_D
        </div>
      </div>
    </div>

    <h2>2. Nascimento</h2>
    <div class="fluxo">
      <div class="fluxo-col">
        <h4>Antes</h4>
        <ol>
          <li>Usuário solicita registro de nascimento.</li>
          <li>Sistema consulta saldo de matrizes (fêmeas ≥ 13-24 meses).</li>
          <li>Permite nascimento até o limite do saldo de matrizes.</li>
          <li>Carência é genérica, não vinculada à data de chegada/evolução.</li>
        </ol>
        <div class="mermaid">
flowchart TD
    INICIO_N([Solicitação de nascimento]) --> CONSULTA_MATRIZES([Consulta saldo de matrizes])
    CONSULTA_MATRIZES --> DECISAO_N{Saldo de matrizes suficiente?}
    DECISAO_N -- Não --> BLOQUEIA_N([Bloqueia operação])
    DECISAO_N -- Sim --> PERMITE_N([Permite nascimento])
    PERMITE_N --> ATUALIZA_SALDO_N([Atualiza saldo de matrizes])
        </div>
      </div>
      <div class="fluxo-col">
        <h4>Depois</h4>
        <ol>
          <li>Usuário solicita registro de nascimento, informando espécie, faixa etária e quantidade.</li>
          <li>Sistema consulta matrizes aptas, considerando carência específica por faixa etária.</li>
          <li>Para cada matriz, verifica datas de chegada + carência.</li>
          <li>Permite nascimento apenas se quantidade ≤ matrizes aptas.</li>
          <li>Se não, exibe questionário de justificativa obrigatório.</li>
          <li>Comunicação entra em análise e aguarda aprovação.</li>
          <li>Se aprovada, efetiva comunicação e atualiza saldos. <b>Motivo da recusa permanece em branco.</b></li>
          <li>Se reprovada, servidor deve preencher <b>Motivo da recusa</b> e descarta comunicação.</li>
          <li>Atualiza saldo de matrizes aptas após nascimento.</li>
        </ol>
        <div class="mermaid">
flowchart TD
    INICIO_ND([Solicitação de nascimento]) --> CONSULTA_MATRIZES_D([Consulta matrizes aptas por faixa etária e datas])
    CONSULTA_MATRIZES_D --> VERIFICA_CARENCIA_ND([Verifica carência das matrizes])
    VERIFICA_CARENCIA_ND --> DECISAO_ND{Matrizes aptas suficientes?}
    DECISAO_ND -- Sim --> PERMITE_ND([Permite nascimento])
    DECISAO_ND -- Não --> QUESTIONARIO_ND([Exibe questionário de justificativa])
    QUESTIONARIO_ND --> SALVA_COMUNIC_ND([Salva comunicação em análise])
    SALVA_COMUNIC_ND --> ANALISE_ND([Servidor analisa comunicação])
    ANALISE_ND --> APROVACAO_ND{Aprovar comunicação?}
    APROVACAO_ND -- Sim --> EFETIVA_ND([Efetiva comunicação e atualiza saldo])
    APROVACAO_ND -- Não --> MOTIVO_RECUSA_ND([Preencher motivo da recusa])
    MOTIVO_RECUSA_ND --> DESCARTA_ND([Descarta comunicação])
    DESCARTA_ND --> FIM_ND([Fim])
    EFETIVA_ND --> FIM_ND
        </div>
      </div>
    </div>

    <h2>Comunicação em Análise por Estouro de Carência</h2>
    <div class="fluxo">
      <div class="fluxo-col" style="flex: 1 1 100%;">
        <ol>
          <li>Usuário tenta registrar evolução ou nascimento antes do prazo mínimo de carência.</li>
          <li>Sistema exibe questionário de justificativa obrigatório.</li>
          <li>Comunicação é registrada com status "Em análise".</li>
          <li>Servidor avalia comunicação.</li>
          <li>Se aprovada, efetiva comunicação e atualiza saldos. <b>Motivo da recusa permanece em branco.</b></li>
          <li>Se reprovada, servidor deve preencher <b>Motivo da recusa</b> e descarta comunicação.</li>
        </ol>
        <div class="mermaid">
flowchart TD
    INICIO([Solicitação de evolução/nascimento]) --> VERIFICA_CARENCIA([Verifica carência])
    VERIFICA_CARENCIA --> DECISAO{Carência cumprida?}
    DECISAO -- Sim --> PERMITE([Permite operação])
    DECISAO -- Não --> QUESTIONARIO([Exibe questionário de justificativa])
    QUESTIONARIO --> SALVA_COMUNIC([Salva comunicação em análise])
    SALVA_COMUNIC --> ANALISE([Servidor analisa comunicação])
    ANALISE --> APROVACAO{Aprovar comunicação?}
    APROVACAO -- Sim --> EFETIVA([Efetiva comunicação e atualiza saldo])
    APROVACAO -- Não --> MOTIVO_RECUSA([Preencher motivo da recusa])
    MOTIVO_RECUSA --> DESCARTA([Descarta comunicação])
    DESCARTA --> FIM([Fim])
    EFETIVA --> FIM
        </div>
      </div>
    </div>

    <div class="obs">
      <strong>Observações Gerais:</strong><br>
      • Todas as regras de carência devem ser aplicadas considerando espécie, faixa etária e quantidade.<br>
      • O sistema deve registrar e consultar datas de chegada, evolução e nascimento para garantir precisão no cálculo do saldo apto.<br>
      • Mensagens de bloqueio devem ser claras e orientativas, promovendo transparência ao usuário.<br>
      • O processo de comunicação em análise garante maior controle e rastreabilidade das exceções, fortalecendo a governança dos procedimentos.<br>
      • <b>O campo "Motivo da recusa" é obrigatório sempre que houver recusa de comunicação em análise.</b>
    </div>
  </div>
</body>
</html>
